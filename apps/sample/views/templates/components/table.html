<div id="table-body">
  <div class="overflow-auto max-h-130">
    <table class="w-full">
      <thead
        class="sticky top-0 z-10 bg-slate-500 text-gray-50 text-xs font-medium uppercase tracking-wider cursor-pointer whitespace-nowrap">
        <tr>
          {% if bulk_actions %}
          <th class="py-3 px-6">
            <!-- Client-side bulk select could be added later with hx-boosted behaviors -->
          </th>
          {% endif %}

          {% for column in table_columns %}
          <th scope="col" class="py-3 px-6">
              {% if column.sortable %}
              <a hx-get="{{ data_url }}" hx-include="#table-controls"
                hx-vals='{"sort": "{{ column.name }}", "sort_direction": "{{ "desc" if sort == column.name and sort_direction == "asc" else "asc" }}"}' hx-target="#table-body" hx-push-url="false"
                class="ml-1">
                {{ column.label or column.name }}
                {% if sort == column.name %}
                {% if sort_direction == 'asc' %}▲{% else %}▼{% endif %}
                {% else %}
                ⇅
                {% endif %}
              </a>
              {% else %}
              <span>{{ column.label or column.name }}</span>
              {% endif %}
          </th>
          {% endfor %}

          {% if table_row_actions and table_row_actions|length > 0 %}
          <th scope="col" class="sticky right-0 py-3 px-6 text-center bg-slate-500">Thao tác</th>
          {% endif %}
        </tr>
      </thead>

      <tbody class="bg-white divide-y divide-gray-200">
        {% if table_data and table_data|length > 0 %}
        {% for row in table_data %}
        <tr
          class="transition-colors duration-150 hover:bg-gray-200 group divide-x divide-gray-200 {% if loop.index0 % 2 == 0 %}bg-gray-100{% else %}bg-white{% endif %}">
          {% if bulk_actions %}
          <td class="px-6 py-4 text-center">
            <input type="checkbox" name="selected" value="{{ row.id or loop.index0 }}">
          </td>
          {% endif %}

          {% for column in table_columns %}
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-{{ column.align or 'center' }}">
            {% set value = row|get_attribute(column.name) %}
            {% if column.type == 'image' %}
            <div class="flex-shrink-0 h-10 w-10">
              <img class="h-10 w-10 rounded-full object-cover" src="{{ value }}" alt="">
            </div>
            {% elif column.type == 'badge' %}
            {% set color = value|get_badge_color %}
            <span
              class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-{{ color }}-100 text-{{ color }}-800">{{
              value }}</span>
            {% elif column.type == 'date' %}
            <span>{{ value|strftime('%d/%m/%Y') }}</span>
            {% elif column.type == 'datetime' %}
            <span>{{ value|strftime('%d/%m/%Y %H:%M') }}</span>
            {% elif column.type == 'currency' %}
            <span>{{ value }}</span>
            {% elif column.type == 'number' %}
            <span>{{ value }}</span>
            {% elif column.type == 'boolean' %}
            {% if value %}<div class="w-4 h-4 text-green-500 inline-block">{% include 'check.svg' %}</div>{% else %}<div
              class="w-4 h-4 text-red-500 inline-block">{% include 'close.svg' %}</div>{% endif %}
            {% else %}
            <span>{{ value or '—' }}</span>
            {% endif %}
          </td>
          {% endfor %}

          {% if table_row_actions and table_row_actions|length > 0 %}
          <td class="px-6 py-4 sticky right-0 {% if loop.index0 % 2 == 0 %}bg-gray-100{% else %}bg-white{% endif %}">
            <div class="flex items-center justify-center gap-2">
              {% for action in table_row_actions %}
              {% set href = (url(action.url, kwargs={'id':row.id}) if action.url else '#') %}
              <a {% if action.hx %}hx-get="{{ href }}" hx-target="#modal-content" hx-swap="innerHTML"
                hx-push-url="false" @htmx:after-swap.document="filterHTMXSwap($event, $el,() => {modalOpen = true})"
                href="#" {% else %}href="{{ href }}" target="_blank" {% endif %} title="{{ action.label }}"
                class="inline-flex p-1.5 border border-transparent rounded-full text-{{ action.color or 'gray' }}-600 hover:text-{{ action.color or 'gray' }}-900 hover:bg-{{ action.color or 'gray' }}-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-{{ action.color or 'gray' }}-500 transition-colors duration-200">
                {% if action.icon %}
                <div class="w-4 h-4">{% include action.icon + '.svg' %}</div>
                {% else %}
                ⋯
                {% endif %}
              </a>
              {% endfor %}
            </div>
          </td>
          {% endif %}
        </tr>
        {% endfor %}
        {% else %}
        <tr>
          <td
            colspan="{{ table_columns|length + (1 if bulk_actions else 0) + (1 if table_row_actions and table_row_actions|length > 0 else 0) }}"
            class="px-6 py-12 text-center text-gray-500">Không có dữ liệu</td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  <div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6">
    <div class="flex items-center space-x-2">
      <p class="text-sm text-gray-700">
        Hiển thị kết quả thứ
        <span class="font-medium">{{ start_item }}</span> -
        <span class="font-medium">{{ end_item }}</span> trong tổng số
        <span class="font-medium">{{ total_items }}</span> kết quả
      </p>
      <div>
        <select name="page_size" form="table-controls" hx-get="{{ data_url }}" hx-include="#table-controls"
          hx-vals='{"page": 1, "sort": "{{ sort }}", "sort_direction": "{{ sort_direction }}"}' hx-target="#table-body"
          hx-push-url="false"
          class="px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
          <option value="10" {% if page_size|int==10 %}selected{% endif %}>10 dòng/trang</option>
          <option value="25" {% if page_size|int==25 %}selected{% endif %}>25 dòng/trang</option>
          <option value="50" {% if page_size|int==50 %}selected{% endif %}>50 dòng/trang</option>
        </select>
      </div>
    </div>
    <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-end">
      {% if export_url %}
      <div class="mx-4">
        <a href="#" hx-get="{{ export_url }}" hx-include="#table-controls" hx-trigger="click" hx-swap="none"
          hx-push-url="false"
          class="inline-flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-white bg-green-500 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
          <div class="w-4 h-4 mr-2">{% include 'export.svg' %}</div>
          Export
        </a>
      </div>
      {% endif %}

      <div>
        <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
          <a hx-get="{{ data_url }}"
            hx-vals='{"page": {{ current_page|int - 1 if current_page|int > 1 else 1 }}, "sort": "{{ sort }}", "sort_direction": "{{ sort_direction }}" }'
            hx-include="#table-controls" hx-target="#table-body" hx-push-url="false"
            class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 {% if current_page|int <= 1 %}pointer-events-none opacity-50{% endif %}">«</a>

          {% for page in visible_pages %}
          <a hx-get="{{ data_url }}"
            hx-vals='{"page": {{ page }}, "sort": "{{ sort }}", "sort_direction": "{{ sort_direction }}" }'
            hx-include="#table-controls" hx-target="#table-body" hx-push-url="false"
            class="relative inline-flex items-center px-4 py-2 border text-sm font-medium {% if page == current_page %}z-10 bg-blue-50 border-blue-500 text-blue-600{% else %}bg-white border-gray-300 text-gray-500 hover:bg-gray-50{% endif %}">{{
            page }}</a>
          {% endfor %}

          <a hx-get="{{ data_url }}"
            hx-vals='{"page": {{ current_page|int + 1 if current_page|int < total_pages|int else total_pages }}, "sort": "{{ sort }}", "sort_direction": "{{ sort_direction }}" }'
            hx-include="#table-controls" hx-target="#table-body" hx-push-url="false"
            class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 {% if current_page|int >= total_pages|int %}pointer-events-none opacity-50{% endif %}">»</a>
        </nav>
      </div>
    </div>
  </div>
</div>